% vim: ts=4 sts=4 sw=4 et tw=75
% preamble here.

\documentclass[nofonts]{book}

\usepackage{geometry}
\usepackage{amsthm}
\usepackage{fontspec}
\usepackage{upquote}
\usepackage{hyperref}
\usepackage{xeCJK}
\usepackage{setspace}
\usepackage{verbatim}
\usepackage{fancyvrb}
\usepackage{fancyhdr}
\usepackage{tikz}
\usepackage{varwidth}
\usepackage{xfrac}
\usepackage[Bjornstrup]{fncychap}
\usepackage{titlesec}
\usepackage{dingbat}

\ChNumVar{\fontsize{76}{80}\usefont{OT1}{pzc}{m}{n}\selectfont}
\ChTitleVar{\raggedleft\Huge\sffamily\bfseries}

\newcounter{exerflag}
\titleformat{\section}
{\bfseries\Large}
{\setcounter{exerflag}{0}\thesection}
{1em}
{}
[{\titlerule[1pt]\vspace{1pt}\titlerule[0.5pt]}]

\geometry{bottom = 2cm, outer = 2cm}
%\geometry{ left = 3cm, right = 3cm, bottom = 2cm }

\pagestyle{fancy}
\fancyhf{}
\fancyhead[EL]{\thepage}
\fancyhead[ER]{\nouppercase{\leftmark}}
\fancyhead[OR]{\thepage}
\fancyhead[OL]{\nouppercase{\rightmark}}

\hypersetup{
    bookmarksnumbered = true
}

\setCJKmainfont[Scale=0.9, BoldFont=WenQuanYi Zen Hei]
{AR PL UKai CN}
\setCJKsansfont[Scale=0.9]{WenQuanYi Zen Hei}
\setCJKmonofont[Scale=0.9]{AR PL UMing CN}
\setmainfont{Century Schoolbook L}
\setsansfont{FreeSans}
\setmonofont{Courier 10 Pitch}

\renewenvironment{quote}
{\itshape}
{}

\newcommand\bookname[1]{{\itshape{#1}}}

\newenvironment{quotesrc}%
{\begin{flushright}}%
    {\end{flushright}}

\renewcommand{\FancyVerbFormatLine}[1]{%
    \makebox[0cm][l]{?}#1}
\newenvironment{badcode}
{ \linespread{0.93}\Verbatim }
{ \endVerbatim }

\newenvironment{wellcode}%
{\linespread{0.93}\verbatim}%
{\endverbatim}

\renewcommand\emph[1]{{\bfseries\textit{#1}}}


\newcounter{exercnt}[chapter]
\renewcommand\theexercnt{\thechapter-\arabic{exercnt}}
\renewcommand\proofname{%
    \stepcounter{exercnt}%
    \textup{\textbf{Exercise\ \theexercnt}}
}
\newenvironment{exercise}
{
    \ifnum \value{exerflag}=0 
        \setcounter{exerflag}{1} 
        {\vspace{2em}\LARGE\smallpencil}
        \vspace{-1em}
        \nopagebreak[0]
    \fi
    \begin{proof}
}
{\end{proof}}

\renewcommand\theenumi{\alph{enumi}}

\title{The Practice of Programming}
\author{Brian W.Kernighan \and Rob Pike \and
    \url{https://github.com/wuzhouhui/tpop}
}
